# MVP: Prompt Enhancer + Image Generator + Judge (CLIP + Aesthetic)

–£—á–µ–±–Ω—ã–π / MVP ML-–ø—Ä–æ–µ–∫—Ç –¥–ª—è SMM –∏ –º–∞–ª–æ–≥–æ –±–∏–∑–Ω–µ—Å–∞.

–°–µ—Ä–≤–∏—Å –ø—Ä–∏–Ω–∏–º–∞–µ—Ç ¬´—Å—ã—Ä–æ–π¬ª –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –ø—Ä–æ–º—Ç, —É–ª—É—á—à–∞–µ—Ç –µ–≥–æ –¥–æ –∞–Ω–≥–ª–æ—è–∑—ã—á–Ω–æ–≥–æ –æ–ø–∏—Å–∞–Ω–∏—è –≤ –±—Ä–µ–Ω–¥-—Å—Ç–∏–ª–µ, –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (mock –∏–ª–∏ Hugging Face), –∞ –∑–∞—Ç–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ü–µ–Ω–∏–≤–∞–µ—Ç –∏ —Ä–∞–Ω–∂–∏—Ä—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—é –ø—Ä–æ–º—Ç—É –∏ —ç—Å—Ç–µ—Ç–∏–∫–µ.


---


## üß† –û–±—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

Client (Postman / Frontend), FastAPI (app), RabbitMQ ---> ML Worker (Prompt Enhancer (Ollama / mock), Image Generator (HF / mock), Judge (CLIP + Aesthetic)), PostgreSQL


---


## –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –Ω–∞ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç

### 1. Prompt Enhancer
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:**
–ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –∫–æ—Ä–æ—Ç–∫–∏–π, —à—É–º–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –ø—Ä–æ–º—Ç (RU / mixed)
–≤ —á–∏—Å—Ç—ã–π, –¥–µ—Ç–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π **English prompt** –¥–ª—è image generation.

**–í–∞—Ä–∏–∞–Ω—Ç—ã backend:**
- `ollama` ‚Äî —á–µ—Ä–µ–∑ –ª–æ–∫–∞–ª—å–Ω—ã–π Ollama (Qwen2.5-1.5B-Instruct)
- `mock` ‚Äî –±–µ–∑ LLM, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `cleaned_prompt`

**–§–∏—á–∏:**
- –æ—á–∏—Å—Ç–∫–∞ —Ç–µ–∫—Å—Ç–∞ (`clean_text`)
- –¥–µ—Ç–µ–∫—Ü–∏—è –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã (`instagram`, `banner`, `website`, –∏ —Ç.–¥.)
- –¥–µ—Ç–µ–∫—Ü–∏—è —Ü–µ–ª–∏ (`promotion`, `branding`, `product_shot`, ‚Ä¶)
- –µ–¥–∏–Ω—ã–π —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º—Ç —Å –±—Ä–µ–Ω–¥-—Å—Ç–∏–ª–µ–º (—Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π –º–∏–Ω–∏–º–∞–ª–∏–∑–º)
- —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ë–î (`enhanced_prompt`)


---


### 2. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

#### Mock-–≥–µ–Ω–µ—Ä–∞—Ü–∏—è
- –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç 1‚Äì4 –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö PNG
- –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –¥–µ—à—ë–≤–æ–≥–æ MVP –∏ —Ç–µ—Å—Ç–æ–≤
- –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏–µ (–±–µ–∑ —Ä–∞–Ω–¥–æ–º–Ω–æ–≥–æ —à—É–º–∞)

#### Hugging Face Inference API
- –º–æ–¥–µ–ª—å: `stabilityai/sdxl-turbo`
- –≤—Å–µ–≥–¥–∞ 1 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ (—ç–∫–æ–Ω–æ–º–∏—è –ª–∏–º–∏—Ç–æ–≤)
- –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
  - `width`, `height`
  - `steps`
  - `guidance`
  - `seed`
- –≤—Å–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è **–Ω–æ—Ä–º–∞–ª–∏–∑—É—é—Ç—Å—è —á–µ—Ä–µ–∑ PIL –∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ PNG**


---


### 3. Judge (–æ—Ü–µ–Ω–∫–∞ –∏ —Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ)

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ä–µ–∞–ª—å–Ω—ã–π ML-—Å—É–¥—å—è, –∞ –Ω–µ –∑–∞–≥–ª—É—à–∫–∞.

#### –ú–æ–¥–µ–ª–∏:
- CLIP: `openai/clip-vit-base-patch32`
- Aesthetic: LAION Aesthetic Predictor (linear head)

#### –ú–µ—Ç—Ä–∏–∫–∏:
- `clip_score` ‚Üí –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π [0, 1]
- `aesthetic_score` ‚Üí raw ‚Üí –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π [0, 1]

#### –§–∏–Ω–∞–ª—å–Ω—ã–π —Å–∫–æ—Ä:

S = 0.7 * clip_n + 0.3 * aes_n

#### –ß—Ç–æ –¥–µ–ª–∞–µ—Ç —Å—É–¥—å—è:

- —Å—á–∏—Ç–∞–µ—Ç —Å–∫–æ—Ä—ã –¥–ª—è –∫–∞–∂–¥–æ–π –∫–∞—Ä—Ç–∏–Ω–∫–∏
- —Å–æ—Ä—Ç–∏—Ä—É–µ—Ç –ø–æ final_score
- –Ω–∞–∑–Ω–∞—á–∞–µ—Ç rank
- —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤—Å—ë –≤ –ë–î (predictions)


---


### 4. –•—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

#### PostgreSQL
–û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã:
- `ml_requests`
- `ml_tasks`
- `predictions`

–í predictions.gen_meta —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –ø–æ–ª–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç:
- –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
- backend (mock / hf)
- —Å–∫–æ—Ä—ã (clip_n, aes_raw, aes_n, final)
- –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ judge


---


### 5. –û—á–µ—Ä–µ–¥–∏ –∏ –≤–æ—Ä–∫–µ—Ä—ã
- RabbitMQ
- ml_worker:
    - —Å–ª—É—à–∞–µ—Ç –æ—á–µ—Ä–µ–¥—å
    - –≤—ã–ø–æ–ª–Ω—è–µ—Ç inference
    - –Ω–µ –∑–∞—Ü–∏–∫–ª–∏–≤–∞–µ—Ç—Å—è –Ω–∞ —Ñ–∞—Ç–∞–ª—å–Ω—ã—Ö –æ—à–∏–±–∫–∞—Ö (404, 401)
    - —Ç–æ–ª—å–∫–æ CPU –¥–ª—è judge (–ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ –∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ)


---


### 6. Docker / Dev-–æ–∫—Ä—É–∂–µ–Ω–∏–µ
–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã:
- app ‚Äî FastAPI
- worker ‚Äî ML-–≤–æ—Ä–∫–µ—Ä
- ollama ‚Äî –ª–æ–∫–∞–ª—å–Ω—ã–π LLM
- rabbitmq
- postgres
- nginx

–ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ docker `compose up --build`


---


## –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è MVP

- –ù–µ –ª–æ–∫–∞–ª—å–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–∞—Ä—Ç–∏–Ω–∫–∏ (–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –º–∞—à–∏–Ω—ã)
- HF: —Ç–æ–ª—å–∫–æ 1 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ (–î–æ—Ä–æ–≥–æ –∏ –µ—Å—Ç—å –ø—Ä–æ–±–ª–µ–º—ã —Å –æ–ø–ª–∞—Ç–æ–π)
- Judge –Ω–∞ CPU (–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –º–∞—à–∏–Ω—ã)
